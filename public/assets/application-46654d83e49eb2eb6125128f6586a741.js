function loadGoogleMaps(){var e=document.createElement("script");e.type="text/javascript",e.src="http://maps.googleapis.com/maps/api/js?sensor=true&callback=createMap",document.body.appendChild(e)}Ext.Loader.setPath({Proximity:"/assets/app"}),Ext.application({name:"Proximity",startupImage:{"320x460":"assets/startup/320x460.png","640x920":"assets/startup/640x920.png","768x1004":"assets/startup/768x1004.png","748x1024":"assets/startup/748x1024.png","1536x2008":"assets/startup/1536x2008.png","1496x2048":"assets/startup/1496x2048.png"},icon:{57:"assets/icons/icon.png",72:"assets/icons/icon~ipad.png",114:"assets/icons/icon@2x.png",144:"assets/icons/icon~ipad@2x.png"},isIconPrecomposed:!0,models:["Search"],views:["Proximity.view.Main"],controllers:["SearchController"],stores:["SearchStore","LocalSearchStore","RemoteSearchStore"],viewport:{autoMaximize:!0},launch:function(){var e=Ext.getStore("LocalSearchStore");try{e.load()}catch(t){console.log(t),localStorage.clear()}Ext.getStore("SearchStore").replaceData(e),Ext.os.is.Phone?Ext.Viewport.add({xclass:"Proximity.view.Main"}):Ext.Viewport.add({xtype:"panel",width:320,height:480,centered:!0,modal:!0,hideOnMaskTap:!1,layout:"fit",items:[{xclass:"Proximity.view.Main"}]}).show()}});var theMap=Ext.create("Ext.Map",{config:{mapOptions:{center:new google.maps.LatLng(38.909027,-77.037165),mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:15}},initialize:function(){console.log("creating the real map")}});window.onload=loadGoogleMaps;var theMap=null,fakeMap=null,createMap=function(){console.log("creating the real map"),theMap=Ext.create("Ext.Map",{useCurrentLocation:!0,autoUpdate:!1,frequency:1e3,mapOptions:{mapTypeId:google.maps.MapTypeId.TERRAIN,zoom:16}})};Ext.define("Proximity.controller.SearchController",{extend:"Ext.app.Controller",config:{refs:{mainView:"mainview",searchView:"searchview"},control:{mainView:{push:"onMainPush",pop:"onMainPop"},searchView:{displayResultsCommand:"onDisplayResultsCommand"}}},onMainPush:function(e,t){this.getMainView().prepareForResults()},onMainPop:function(e,t){this.getMainView().prepareForSearch()},onDisplayResultsCommand:function(e,t){},launch:function(){this.callParent(arguments),console.log("launch")},init:function(){this.callParent(arguments),console.log("init")}}),Ext.define("Proximity.view.search.SearchField",{extend:"Ext.field.Search",xtype:"xsearchField",config:{listeners:{clearicontap:"hideIosSearchBar",focus:"hideIosSearchBar",mousedown:"hideIosSearchBar"}},hideIosSearchBar:function(){console.log("hideIosCrap"),window.scrollTo(0,1),setTimeout(function(){window.scrollTo(0,1)},1),setTimeout(function(){window.scrollTo(0,1)},10)},getElementConfig:function(){var e=this.callParent();return e.tag="form",e.onsubmit="return false;",e}}),Ext.define("Proximity.model.Search",{extend:"Ext.data.Model",xtype:"xsearch",config:{idProperty:"id",fields:[{name:"id",type:"int"},{name:"dateCreated",type:"date",dateFormat:"c",defaultValue:new Date},{name:"term",type:"string"},{name:"category",type:"string"}],validations:[{type:"presence",field:"id"},{type:"presence",field:"dateCreated"},{type:"presence",field:"term"}]}}),Ext.define("Proximity.store.LocalSearchStore",{extend:"Ext.data.Store",config:{model:"Proximity.model.Search",autoload:!0,sorters:[{property:"term",direction:"ASC"}],proxy:{type:"localstorage",id:"notes-store"}},saveSearch:function(e){try{this.load()}catch(t){console.log(t),localStorage.clear()}if(e.term&&this.findExact("term",e.term)<0){console.log("storing: "+e.term),this.add({term:e.term,category:e.category});while(this.getData().length>10)this.removeAt(0);this.sync()}},clearCache:function(){localStorage.clear(),this.sync(),Ext.getCmp("searchFld").reset(),Ext.getStore("SearchStore").replaceData(this)}}),Ext.define("Proximity.store.RemoteSearchStore",{extend:"Ext.data.Store",config:{model:"Proximity.model.Search",data:[{term:"afl games",category:"event"},{term:"albert park lake",category:"place"},{term:"italian restaurants",category:"business"},{term:"rest rooms",category:"place"},{term:"financial planners",category:"business"},{term:"petrol stations",category:"business"},{term:"medical centres",category:"business"},{term:"medical supplies",category:"product"},{term:"mattresses",category:"product"},{term:"mascara",category:"product"},{term:"apples",category:"product"},{term:"apple stores",category:"business"},{term:"ambulance",category:"service"},{term:"taxi",category:"service"},{term:"tax agents",category:"business"},{term:"trampolining",category:"business"},{term:"trampolines",category:"product"},{term:"pizza",category:"product"},{term:"pizza restaurants",category:"business"},{term:"party hire",category:"business"},{term:"fishing supplies",category:"business"},{term:"medallions",category:"product"},{term:"cafes",category:"business"},{term:"cafetieres",category:"product"},{term:"coffee shops",category:"business"},{term:"coffee",category:"product"},{term:"toys",category:"product"},{term:"toilets",category:"place"},{term:"fish - seafood",category:"product"},{term:"fish and chip shops",category:"business"}],autoLoad:!0,sorters:[{property:"term",direction:"ASC"}],filters:null}}),Ext.define("Proximity.store.SearchStore",{extend:"Ext.data.Store",config:{model:"Proximity.model.Search",data:[],autoLoad:!0,sorters:[{property:"term",direction:"ASC"}]},replaceData:function(e){var t=Ext.Array.pluck(e.getRange(),"data");t.length>0?this.setData(t):this.clearData()},showMatches:function(e){var t=Ext.getStore("RemoteSearchStore"),n=Ext.getStore("LocalSearchStore"),r=this.createRegexes(e),i=this.findMatches(n,r),s=this.findMatches(t,r);i.getRange().length==0&&s.getRange().length==0?this.clearData():this.setData(this.merge(Ext.Array.pluck(i.getRange(),"data"),Ext.Array.pluck(s.getRange(),"data")))},createRegexes:function(e){var t=[],n=e.split(" ");for(var r=0;r<n.length;++r){if(!n[r])continue;t.push(new RegExp("^"+n[r],"i"))}return t},findMatches:function(e,t){return e.queryBy(function(e){var n=e.get("term");for(i=0;i<t.length;i++)if(t[i].test(n))return!0;return!1})},merge:function(){var e=Ext.Array.flatten(arguments),t=[];for(var n=0,r=e.length;n<r;n++){var i=e[n];this.contains(t,i)||t.push(i)}return t},contains:function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]&&t&&e[n].term===t.term)return!0;return!1}}),Ext.define("Proximity.view.Main",{extend:"Ext.navigation.View",alias:"widget.mainview",requires:["Proximity.view.search.SearchView"],stores:["SearchStore","LocalSearchStore"],config:{autoDestroy:!1,navigationBar:{docked:"top",animation:{duration:15},items:[{id:"searchFld",xtype:"xsearchField",placeHolder:"Search...",autoComplete:!1,autoCapitalize:!1,listeners:{keyup:function(e,t){Ext.getCmp("searchView").onSearchKeyUp(e,t)},clearicontap:function(e,t){Ext.getCmp("searchView").onClearIconTap(e,t)}}},{id:"viewFlipButton",xtype:"button",hidden:!0,align:"right",ui:"action",action:"viewFlip",text:"Map"}],listeners:{back:function(){this.getBackButton().hide();var e=Ext.getCmp("viewFlipButton");this.backButtonStack.length==2?e.hide():e.setText(e.activeResults?"List":"Map")}}},layout:{type:"card",animation:{duration:150,easing:"ease-in-out",type:"slide",direction:"left"}},items:[{id:"searchView",xtype:"searchview"}]},initialize:function(){this.prepareForSearch(),this.callSuper()},prepareForSearch:function(){this.getNavigationBar().backButtonStack.length==1&&(this.getNavigationBar().leftBox.setCentered(!0),Ext.get("searchFld").show())},prepareForResults:function(){this.getNavigationBar().backButtonStack.length==2&&(this.getNavigationBar().getBackButton().show(),Ext.get("searchFld").hide(),this.getNavigationBar().leftBox.setCentered(!1),Ext.getCmp("viewFlipButton").show())}}),Ext.define("Proximity.view.search.SearchView",{extend:"Ext.Container",requires:["Ext.data.Store","Ext.List"],stores:["SearchStore","LocalSearchStore"],alias:"widget.searchview",config:{layout:{type:"fit"},items:[{xtype:"list",store:"SearchStore",itemId:"searchListItem",itemCls:"list-item-custom",selectedItemCls:"list-item-custom-selected",itemTpl:'<span class="{category} search-icon"></span><div class="list-item-term">{term}</div>',itemHeight:33,ui:"round",pinHeaders:!1,variableHeights:!1,emptyText:'<div style="margin-top: 20px; text-align: center">No Matching Items</div>',onItemDisclosure:!1,disableSelection:!1}],listeners:[{delegate:"#searchListItem",event:"select",fn:"onSearchListSelect"},{delegate:"xsearchField",event:"keyup",fn:"onSearchKeyUp"}]},onSearchKeyUp:function(e,t){console.log("onSearchKeyUp"),window.scrollTo(0,1);var n=Ext.getStore("SearchStore"),r=e.getValue().trim();console.log('"'+r+'"'),t.event.keyCode==13?this.doSearch({term:r,category:"user"}):r?n.showMatches(r):n.replaceData(Ext.getStore("LocalSearchStore"))},onSearchListSelect:function(e,t,n,r,i,s){console.log("onSearchListSelect("+t.data.term+")"),setTimeout(function(){e.deselect(t)},500),this.doSearch(t.data)},doSearch:function(e){var t=Ext.getStore("LocalSearchStore");console.log("search"),console.log(e);if(e.term=="!!!"){t.clearCache();return}t.saveSearch(e),Ext.getCmp("searchFld").reset(),Ext.getStore("SearchStore").replaceData(t),this.fireEvent("displayResultsCommand",this,e.term)},onClearIconTap:function(){Ext.getStore("SearchStore").replaceData(Ext.getStore("LocalSearchStore"))}});